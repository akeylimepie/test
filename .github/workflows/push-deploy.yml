name: Deploy

on:
  push:
    branches:
      - main

jobs:
  deploy:
    uses: ./.github/workflows/deploy.yml
    secrets: inherit

  notify:
    needs:
      - deploy
    if: ${{ always() }}
    runs-on: ubuntu-latest
    steps:
      - id: changes
        uses: akeylimepie/changes-action@main

      - name: Status
        id: status
        run: |
          if [[ ${{ needs.deploy.result }} == "success" ]]; then
              echo "icon=" >> $GITHUB_OUTPUT
          else
              echo "icon=❌" >> $GITHUB_OUTPUT
          fi

      - name: Notify
        env:
          DEPLOY_ICON: ${{ steps.status.outputs.icon }}
          DEPLOY_CHANGES: ${{ steps.changes.outputs.text }}
        run: |
          echo "$DEPLOY_ICON $DEPLOY_CHANGES"
